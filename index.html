<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Token Grant Calculator</title>
  <style>
    @import url("https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap");

    :root {
      --text-primary: #111827;
      --text-secondary: #4B5563;
      --border: #E5E7EB;
      --danger: #D92D20;
      --success: #079455;

      --radius-card: 24px;
      --radius-control: 8px;

      --shadow-card: 0px 4px 6px -2px #10182808, 0px 12px 16px -4px #10182814;
      --focus: 0 0 0 4px rgba(22, 70, 206, 0.18);

      /* 4px scale */
      --space-8: 8px;
      --space-12: 12px;
      --space-16: 16px;
      --space-20: 20px;
      --space-24: 24px;
      --space-28: 28px;
      --space-32: 32px;
    }

    * { box-sizing: border-box; }

    body {
      font-family: "Inter Display", Inter, system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
      font-size: 16px;
      line-height: 1.5;
      margin: 0;
      color: var(--text-primary);
      background: var(--background);
    }

    /* Webflow-style layout primitives (kept small on purpose) */
    .page-wrapper { min-height: 100%; padding: 1rem; }
    .container { max-width: 1040px; margin: 0 auto; }
    .section { padding: 0; }

    .grid-2col {
      display: grid;
      /* One column on all devices (consistent behavior) */
      grid-template-columns: 1fr;
      gap: var(--space-20);
      align-items: start;
    }

    @media (max-width: 991px) {
      .grid-2col { grid-template-columns: 1fr; }
    }

    .card, .card-2 {
      border: 1px solid var(--border);
      border-radius: var(--radius-card);
      padding: var(--space-24);
      box-shadow: var(--shadow-card);
      background: #fff;
      max-width: 40rem;
      width: 100%;
      margin: 0 auto;
    }

    .stack { display: flex; flex-direction: column; gap: var(--space-16); }
    .stack-lg { gap: var(--space-24); }
    .row { display: flex; gap: var(--space-12); align-items: center; flex-wrap: wrap; }
    .row-between { justify-content: space-between; }

    .heading-xl { font-size: 28px; line-height: 1.2; margin: 0; letter-spacing: -0.02em; }
    .heading-md { font-size: 18px; line-height: 1.3; margin: 0; letter-spacing: -0.01em; }
    .text-muted { color: var(--text-secondary); margin: 0; }
    .text-sm { font-size: 13px; line-height: 1.5; }

    .form-field { display: grid; gap: var(--space-8); }
    .label { font-size: 13px; font-weight: 500; color: var(--text-primary); }

    .input, .select {
      width: 100%;
      border: 1px solid var(--border);
      border-radius: var(--radius-control);
      height: 56px;
      padding: 0 var(--space-16);
      font-size: 16px;
      outline: none;
      background: #fff;
      color: var(--text-primary);
      transition: box-shadow 160ms ease, border-color 160ms ease, transform 160ms ease;
    }

    .input:focus, .select:focus { box-shadow: var(--focus); border-color: rgba(22, 70, 206, 0.35); }

    .help, .error {
      font-size: 13px;
      margin: 0;
    }

    .help { color: var(--text-secondary); }
    .error { color: var(--danger); display: none; }
    .field-invalid .input, .field-invalid .select { border-color: rgba(217, 45, 32, 0.45); }
    .field-invalid .error { display: block; }

    .segmented {
      display: inline-flex;
      border: 1px solid var(--border);
      border-radius: 999px;
      padding: 4px;
      background: rgba(17, 24, 39, 0.03);
      gap: 4px;
    }

    .segmented-button {
      border: 0;
      border-radius: 999px;
      padding: 8px 12px;
      font-size: 13px;
      background: transparent;
      color: var(--text-secondary);
      cursor: pointer;
      transition: background 160ms ease, color 160ms ease, transform 160ms ease;
    }

    .segmented-button[aria-pressed="true"] {
      background: #fff;
      color: var(--text-primary);
      box-shadow: 0 8px 18px rgba(17, 24, 39, 0.08);
    }

    .button {
      width: 100%;
      height: 56px;
      border: 0;
      background: linear-gradient(to bottom, #3D65D6 0%, #1646CE 100%);
      color: #fff;
      font-size: 16px;
      font-weight: 500;
      border-radius: var(--radius-control);
      padding: 0 var(--space-16);
      cursor: pointer;
      transition: transform 120ms ease, opacity 120ms ease;
      box-shadow: none;
    }

    .button:active { transform: translateY(0px); }
    .button:disabled { cursor: not-allowed; transform: none; }

    /* Results: hidden until valid input + smooth reveal */
    .results {
      overflow: hidden;
      max-height: 0;
      opacity: 0;
      transform: translateY(8px);
      transition: max-height 360ms ease, opacity 240ms ease, transform 240ms ease;
      will-change: max-height, opacity, transform;
      pointer-events: none;
    }

    .results.is-visible {
      opacity: 1;
      transform: translateY(0);
      pointer-events: auto;
    }

    .results-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: var(--space-12);
      margin-top: var(--space-12);
    }

    .metric {
      border: 1px solid var(--border);
      border-radius: var(--radius-control);
      padding: var(--space-16);
      background: rgba(17, 24, 39, 0.02);
    }

    .metric-spaced { margin-top: var(--space-12); }

    .metric .k { font-size: 13px; color: var(--text-secondary); margin: 0 0 6px; }
    .metric .v { font-size: 20px; font-weight: 600; margin: 0; letter-spacing: -0.01em; }

    .badge {
      display: inline-flex;
      align-items: center;
      gap: var(--space-8);
      padding: 8px 12px;
      border-radius: 999px;
      border: 1px solid var(--border);
      background: rgba(17, 24, 39, 0.02);
      font-size: 12px;
      color: var(--text-secondary);
      white-space: nowrap;
    }

    .dot {
      width: 8px;
      height: 8px;
      border-radius: 999px;
      background: var(--success);
      display: inline-block;
    }
  </style>
</head>
<body>
  <div class="page-wrapper">
    <div class="container section">
      <div class="stack stack-lg">
        <div class="grid-2col">
          <div class="card">
            <div class="stack">
              <div class="row row-between">
                <h2 class="heading-md">Token grant calculator</h2>
                <p class="text-muted text-sm">Estimates only.</p>
              </div>

              <!-- Inputs (functionality based on your "Simple Token Grant Calculator") -->
              <div class="form-field" id="grantTokensField">
                <label class="label" for="grantTokens">Total token grant</label>
                <input class="input" id="grantTokens" inputmode="decimal" autocomplete="off" placeholder="e.g. 50000" />
                <p class="error">Enter a valid token amount greater than 0.</p>
              </div>

              <div class="form-field" id="currentPriceField">
                <label class="label" for="currentPrice">Current token price (USD)</label>
                <input class="input" id="currentPrice" inputmode="decimal" autocomplete="off" placeholder="e.g. 0.25" />
                <p class="error">Enter a valid price (0 or greater).</p>
              </div>

              <div class="form-field" id="vestingYearsField">
                <label class="label" for="vestingYears">Vesting length (years)</label>
                <input class="input" id="vestingYears" inputmode="decimal" autocomplete="off" placeholder="e.g. 4" />
                <p class="error">Enter a valid vesting length greater than 0.</p>
              </div>

              <button class="button" id="calculate" type="button">Calculate</button>
            </div>
          </div>

          <div class="card-2" aria-live="polite">
            <div class="row row-between">
              <h2 class="heading-md">Results</h2>
            </div>

            <!-- Results (only what’s required) -->
            <div class="results" id="results" aria-hidden="true" style="max-height:0px;">
              <div class="results-grid">
                <div class="metric">
                  <p class="k">Total grant value today</p>
                  <p class="v" id="totalPaperValue">—</p>
                </div>
                <div class="metric">
                  <p class="k">Monthly vesting (tokens)</p>
                  <p class="v" id="monthlyTokens">—</p>
                </div>
                <div class="metric">
                  <p class="k">Monthly vesting value (today)</p>
                  <p class="v" id="monthlyValue">—</p>
                </div>
              </div>
            </div>

            <div class="text-muted text-sm" id="resultsHint">Fill in the form to see your results.</div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    const $ = (id) => document.getElementById(id);

    const els = {
      grantTokens: $("grantTokens"),
      currentPrice: $("currentPrice"),
      vestingYears: $("vestingYears"),
      calculate: $("calculate"),

      grantTokensField: $("grantTokensField"),
      currentPriceField: $("currentPriceField"),
      vestingYearsField: $("vestingYearsField"),

      results: $("results"),
      resultsHint: $("resultsHint"),

      totalPaperValue: $("totalPaperValue"),
      monthlyTokens: $("monthlyTokens"),
      monthlyValue: $("monthlyValue"),
    };

    let hasCalculated = false;

    function toNumberOrNaN(inputEl) {
      const raw = (inputEl?.value || "").toString().replace(/,/g, "").trim();
      if (!raw) return NaN;
      const val = parseFloat(raw);
      return Number.isFinite(val) ? val : NaN;
    }

    function formatUSD(num, { maximumFractionDigits = 2 } = {}) {
      const v = Number(num) || 0;
      return v.toLocaleString("en-US", {
        style: "currency",
        currency: "USD",
        maximumFractionDigits
      });
    }

    function formatNumber(num, { maximumFractionDigits = 4 } = {}) {
      const v = Number(num) || 0;
      return v.toLocaleString("en-US", { maximumFractionDigits });
    }

    function setFieldValidity(fieldEl, isValid, { showErrors }) {
      fieldEl.classList.toggle("field-invalid", Boolean(showErrors && !isValid));
    }

    function showResults() {
      els.results.setAttribute("aria-hidden", "false");
      els.resultsHint.style.display = "none";
      els.results.classList.add("is-visible");
      requestAnimationFrame(() => {
        els.results.style.maxHeight = `${els.results.scrollHeight}px`;
      });
    }

    function hideResults() {
      hasCalculated = false;
      const currentHeight = els.results.scrollHeight;
      els.results.style.maxHeight = `${currentHeight}px`;
      void els.results.offsetHeight;
      els.results.classList.remove("is-visible");
      els.results.style.maxHeight = "0px";
      els.results.setAttribute("aria-hidden", "true");
      els.resultsHint.style.display = "";
    }

    function isClearedToDefault() {
      const allEmpty = [
        els.grantTokens.value,
        els.currentPrice.value,
        els.vestingYears.value,
      ].every((v) => !String(v || "").trim());
      return allEmpty;
    }

    function validate({ showErrors }) {
      const grantTokens = toNumberOrNaN(els.grantTokens);
      const currentPrice = toNumberOrNaN(els.currentPrice);
      const vestingYears = toNumberOrNaN(els.vestingYears);

      const grantValid = Number.isFinite(grantTokens) && grantTokens > 0;
      const priceValid = Number.isFinite(currentPrice) && currentPrice >= 0;
      const vestingYearsValid = Number.isFinite(vestingYears) && vestingYears > 0;
      const totalVestingMonths = vestingYearsValid ? vestingYears * 12 : NaN;

      setFieldValidity(els.grantTokensField, grantValid, { showErrors });
      setFieldValidity(els.currentPriceField, priceValid, { showErrors });
      setFieldValidity(els.vestingYearsField, vestingYearsValid, { showErrors });

      const allValid = [
        grantValid,
        priceValid,
        vestingYearsValid,
      ].every(Boolean);

      return {
        allValid,
        grantTokens: grantValid ? grantTokens : 0,
        currentPrice: priceValid ? currentPrice : 0,
        vestingYears: vestingYearsValid ? vestingYears : 0,
        totalVestingMonths: Number.isFinite(totalVestingMonths) ? totalVestingMonths : 0,
      };
    }

    function calculate(v) {
      const totalVestingMonths = v.totalVestingMonths;

      // 1) Total grant value today (full paper value)
      const totalPaperValue = v.grantTokens * v.currentPrice;

      // 2) Monthly vesting + monthly value
      const monthlyTokens = totalVestingMonths > 0
        ? v.grantTokens / totalVestingMonths
        : 0;

      const monthlyValue = monthlyTokens * v.currentPrice;

      // Update UI
      els.totalPaperValue.textContent = formatUSD(totalPaperValue);
      els.monthlyTokens.textContent = formatNumber(monthlyTokens, { maximumFractionDigits: 4 });
      els.monthlyValue.textContent = formatUSD(monthlyValue);
    }

    function validateAndMaybeCalculate({ shouldCalculate }) {
      if (isClearedToDefault()) {
        hideResults();
        validate({ showErrors: shouldCalculate });
        return;
      }

      const v = validate({ showErrors: shouldCalculate });
      if (!v.allValid) {
        if (!hasCalculated) hideResults();
        return;
      }

      if (shouldCalculate) {
        hasCalculated = true;
        calculate(v);
        showResults();
      }
    }

    // Live update after first calculate (kept from the nicer UX pattern)
    const liveUpdate = () => {
      if (!hasCalculated) return;
      if (isClearedToDefault()) {
        hideResults();
        validate({ showErrors: false });
        return;
      }
      const v = validate({ showErrors: false });
      if (v.allValid) {
        calculate(v);
        showResults();
      }
    };

    els.grantTokens.addEventListener("input", liveUpdate);
    els.currentPrice.addEventListener("input", liveUpdate);
    els.vestingYears.addEventListener("input", liveUpdate);

    els.calculate.addEventListener("click", () => {
      validateAndMaybeCalculate({ shouldCalculate: true });
    });

    document.addEventListener("keydown", (e) => {
      if (e.key !== "Enter") return;
      const t = e.target;
      if (!t || t.tagName !== "INPUT") return;
      e.preventDefault();
      validateAndMaybeCalculate({ shouldCalculate: true });
    });

    els.results.addEventListener("transitionend", (e) => {
      if (e.propertyName !== "max-height") return;
      if (els.results.classList.contains("is-visible")) {
        els.results.style.maxHeight = "none";
      }
    });
  </script>
  <script>
    (function () {
      const TYPE = "token-calculator:height";

      function sendHeight() {
        const height = Math.max(
          document.documentElement.scrollHeight,
          document.body ? document.body.scrollHeight : 0
        );

        // pošalji visinu parent-u (Webflow)
        window.parent.postMessage(
          { type: TYPE, height },
          "*"
        );
      }

      // osnovni momenti
      window.addEventListener("load", sendHeight);
      window.addEventListener("resize", sendHeight);

      // hvata promene layouta (najbitnije)
      if ("ResizeObserver" in window) {
        const ro = new ResizeObserver(sendHeight);
        ro.observe(document.documentElement);
      } else {
        setInterval(sendHeight, 500);
      }

      // hvata animacije (max-height transition)
      document.addEventListener("transitionend", sendHeight, true);

      // “nudge” posle load-a (fontovi, wrap, itd.)
      setTimeout(sendHeight, 50);
      setTimeout(sendHeight, 200);
      setTimeout(sendHeight, 800);
    })();
  </script>
</body>
</html>
